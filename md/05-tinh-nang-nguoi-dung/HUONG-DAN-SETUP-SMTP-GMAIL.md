# ğŸ“§ HÆ¯á»šNG DáºªN SETUP SMTP GMAIL - CHI TIáº¾T Tá»ªNG BÆ¯á»šC

## ğŸ¯ Má»¥c ÄÃ­ch

HÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n cáº¥u hÃ¬nh SMTP Gmail Ä‘á»ƒ gá»­i email xÃ¡c thá»±c tá»± Ä‘á»™ng khi ngÆ°á»i dÃ¹ng Ä‘Äƒng kÃ½ tÃ i khoáº£n.

**Thá»i gian**: ~10 phÃºt

---

## ğŸ“‹ YÃªu Cáº§u

- âœ… TÃ i khoáº£n Gmail (miá»…n phÃ­)
- âœ… Quyá»n truy cáº­p Google Account
- âœ… Internet connection

---

## ğŸš€ BÆ¯á»šC 1: Báº¬T 2-STEP VERIFICATION

### Táº¡i sao cáº§n bÆ°á»›c nÃ y?
Gmail yÃªu cáº§u báº­t **2-Step Verification** trÆ°á»›c khi cÃ³ thá»ƒ táº¡o App Password.

### CÃ¡c bÆ°á»›c thá»±c hiá»‡n:

#### 1.1 Truy cáº­p Google Account Security

1. Má»Ÿ trÃ¬nh duyá»‡t web
2. Truy cáº­p: **https://myaccount.google.com/security**
3. ÄÄƒng nháº­p vá»›i Gmail cá»§a báº¡n

#### 1.2 TÃ¬m "2-Step Verification"

1. Cuá»™n xuá»‘ng pháº§n **"How you sign in to Google"**
2. TÃ¬m má»¥c **"2-Step Verification"**

#### 1.3 Báº­t 2-Step Verification

**Náº¿u tháº¥y "OFF":**
```
1. Click vÃ o "2-Step Verification"
2. Click nÃºt "GET STARTED" hoáº·c "Turn On"
3. Nháº­p máº­t kháº©u Gmail Ä‘á»ƒ xÃ¡c nháº­n
4. Chá»n phÆ°Æ¡ng thá»©c nháº­n mÃ£:
   - ThÃ´ng bÃ¡o trÃªn Ä‘iá»‡n thoáº¡i (khuyáº¿n nghá»‹)
   - SMS text message
   - Phone call
5. Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i
6. Nháº­n vÃ  nháº­p mÃ£ xÃ¡c thá»±c
7. Click "Turn On"
```

**Náº¿u tháº¥y "ON":**
```
âœ… Báº¡n Ä‘Ã£ báº­t rá»“i! Chuyá»ƒn sang BÆ°á»›c 2
```

#### 1.4 Kiá»ƒm tra

- Quay láº¡i https://myaccount.google.com/security
- Kiá»ƒm tra "2-Step Verification" cÃ³ status **"ON"** âœ…

---

## ğŸ”‘ BÆ¯á»šC 2: Táº O APP PASSWORD

### App Password lÃ  gÃ¬?
App Password lÃ  máº­t kháº©u Ä‘áº·c biá»‡t (16 kÃ½ tá»±) Ä‘Æ°á»£c Google táº¡o ra cho cÃ¡c á»©ng dá»¥ng bÃªn thá»© 3. NÃ³ an toÃ n hÆ¡n viá»‡c dÃ¹ng máº­t kháº©u Gmail chÃ­nh.

### CÃ¡c bÆ°á»›c thá»±c hiá»‡n:

#### 2.1 Truy cáº­p App Passwords

**CÃ¡ch 1 (Trá»±c tiáº¿p):**
```
https://myaccount.google.com/apppasswords
```

**CÃ¡ch 2 (Tá»« Security Page):**
```
1. VÃ o https://myaccount.google.com/security
2. TÃ¬m "2-Step Verification" â†’ Click vÃ o
3. Cuá»™n xuá»‘ng tÃ¬m "App passwords"
4. Click vÃ o "App passwords"
```

#### 2.2 Táº¡o App Password Má»›i

1. **Select app dropdown:**
   - Click vÃ o dropdown
   - Chá»n **"Mail"**

2. **Select device dropdown:**
   - Click vÃ o dropdown
   - Chá»n **"Other (Custom name)"**
   - Nháº­p tÃªn: **"Website Me Phuong Thi Theo"**

3. **Generate:**
   - Click nÃºt **"GENERATE"**

#### 2.3 Copy App Password

Má»™t popup sáº½ hiá»‡n lÃªn vá»›i password **16 kÃ½ tá»±** (dáº¡ng: `xxxx xxxx xxxx xxxx`)

**VÃ Dá»¤:**
```
abcd efgh ijkl mnop
```

âš ï¸ **LÆ¯U Ã QUAN TRá»ŒNG:**
- **COPY ngay password nÃ y** (chá»‰ hiá»‡n 1 láº§n!)
- Giá»¯ nguyÃªn khoáº£ng tráº¯ng
- KhÃ´ng Ä‘Ã³ng popup cho Ä‘áº¿n khi Ä‘Ã£ copy xong

**CÃ¡ch copy:**
```
Windows: Ctrl + C
Mac: Cmd + C

Hoáº·c click nÃºt "Copy" trong popup
```

#### 2.4 LÆ°u App Password

**Option 1: Paste vÃ o Notepad ngay**
```
1. Má»Ÿ Notepad
2. Paste password (Ctrl + V)
3. Save file táº¡m (Ä‘á»ƒ trÃ¡nh máº¥t)
```

**Option 2: Paste trá»±c tiáº¿p vÃ o file .env (BÆ°á»›c 3)**

---

## ğŸ“ BÆ¯á»šC 3: Cáº¤U HÃŒNH FILE `.env`

### 3.1 Kiá»ƒm tra file `.env` Ä‘Ã£ tá»“n táº¡i chÆ°a

```
ThÆ° má»¥c: C:\Users\Admin\Desktop\mephuongthitheo\
File: .env
```

**Náº¿u chÆ°a cÃ³ file `.env`:**
```
1. Má»Ÿ thÆ° má»¥c project
2. Click pháº£i â†’ New â†’ Text Document
3. Äá»•i tÃªn tá»« "New Text Document.txt" thÃ nh ".env"
4. Windows sáº½ cáº£nh bÃ¡o â†’ Click Yes
```

### 3.2 Má»Ÿ file `.env`

```
Right-click file .env â†’ Open with â†’ Notepad (hoáº·c VS Code)
```

### 3.3 ThÃªm/Cáº­p nháº­t ná»™i dung

Copy vÃ  paste Ä‘oáº¡n sau vÃ o file `.env`:

```env
# Database
DATABASE_URL="file:./prisma/dev.db"

# ===== EMAIL CONFIGURATION (SMTP) =====
# Cáº¥u hÃ¬nh Ä‘á»ƒ gá»­i email xÃ¡c thá»±c tá»± Ä‘á»™ng

# SMTP Server cá»§a Gmail
SMTP_HOST=smtp.gmail.com

# Port cá»§a Gmail SMTP (587 cho TLS)
SMTP_PORT=587

# KhÃ´ng dÃ¹ng SSL (dÃ¹ng TLS thay tháº¿)
SMTP_SECURE=false

# Email Gmail cá»§a báº¡n
SMTP_USER=your-email@gmail.com

# App Password (16 kÃ½ tá»±) vá»«a táº¡o á»Ÿ BÆ°á»›c 2
SMTP_PASS=abcd efgh ijkl mnop

# TÃªn ngÆ°á»i gá»­i (hiá»ƒn thá»‹ trong email)
SMTP_FROM_NAME="Máº¹ PhÆ°Æ¡ng Thá»‹ Theo"

# ===== APPLICATION URL =====
# URL cá»§a website (localhost khi develop)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ===== VNPAY (Náº¿u cÃ³) =====
# VNPAY_TMN_CODE=your_code
# VNPAY_HASH_SECRET=your_secret
```

### 3.4 Thay tháº¿ thÃ´ng tin thá»±c

**Cáº§n thay:**

1. **`SMTP_USER`** - Thay báº±ng email Gmail cá»§a báº¡n
   ```env
   SMTP_USER=john.doe@gmail.com
   ```

2. **`SMTP_PASS`** - Thay báº±ng App Password 16 kÃ½ tá»±
   ```env
   SMTP_PASS=abcd efgh ijkl mnop
   ```

**VÃ Dá»¤ HOÃ€N CHá»ˆNH:**

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=john.doe@gmail.com
SMTP_PASS=abcd efgh ijkl mnop
SMTP_FROM_NAME="Máº¹ PhÆ°Æ¡ng Thá»‹ Theo"
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 3.5 LÆ°u file

```
File â†’ Save (hoáº·c Ctrl + S)
```

âš ï¸ **LÆ¯U Ã:**
- File `.env` Ä‘Ã£ cÃ³ trong `.gitignore` â†’ an toÃ n, khÃ´ng commit lÃªn Git
- Giá»¯ nguyÃªn khoáº£ng tráº¯ng trong App Password
- KhÃ´ng dÃ¹ng dáº¥u ngoáº·c kÃ©p cho password

---

## ğŸ”„ BÆ¯á»šC 4: RESTART SERVER

Server cáº§n restart Ä‘á»ƒ load biáº¿n mÃ´i trÆ°á»ng má»›i tá»« file `.env`

### 4.1 Stop server hiá»‡n táº¡i

Trong terminal Ä‘ang cháº¡y `npm run dev`:
```
Nháº¥n: Ctrl + C
```

### 4.2 Start láº¡i server

```bash
npm run dev
```

### 4.3 Kiá»ƒm tra console

Server khá»Ÿi Ä‘á»™ng thÃ nh cÃ´ng náº¿u tháº¥y:
```
âœ“ Ready in 2.5s
â—‹ Local:    http://localhost:3000
```

---

## ğŸ§ª BÆ¯á»šC 5: TEST Gá»¬I EMAIL

### 5.1 ÄÄƒng kÃ½ tÃ i khoáº£n test

1. Truy cáº­p: **http://localhost:3000/account/register**

2. Äiá»n thÃ´ng tin (dÃ¹ng **email tháº­t** Ä‘á»ƒ test):
   ```
   Há» vÃ  tÃªn: Test User
   Email: your-real-email@gmail.com  â† DÃ¹ng email tháº­t!
   Sá»‘ Ä‘iá»‡n thoáº¡i: 0912345678
   Äá»‹a chá»‰: 123 Test Street
   Máº­t kháº©u: Test123
   XÃ¡c nháº­n: Test123
   âœ“ Äiá»u khoáº£n
   ```

3. Click **"Táº¡o tÃ i khoáº£n"**

### 5.2 Kiá»ƒm tra thÃ´ng bÃ¡o

Sau khi submit:
```
âœ… Toast: "ÄÄƒng kÃ½ thÃ nh cÃ´ng!"
âœ… Toast: "ğŸ“§ Vui lÃ²ng kiá»ƒm tra email..."
âœ… Redirect to: /account/verify-pending
```

### 5.3 Kiá»ƒm tra Console Logs

Trong terminal Ä‘ang cháº¡y `npm run dev`, tÃ¬m dÃ²ng:
```
âœ… Verification email sent to: your-email@gmail.com
```

**Náº¿u tháº¥y dÃ²ng nÃ y** â†’ Email Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng! âœ…

**Náº¿u tháº¥y lá»—i:**
```
âŒ Error sending verification email: [error message]
```
â†’ Xem pháº§n **Troubleshooting** bÃªn dÆ°á»›i

### 5.4 Kiá»ƒm tra Email Inbox

1. Má»Ÿ Gmail inbox
2. TÃ¬m email tá»« **"Máº¹ PhÆ°Æ¡ng Thá»‹ Theo"**
3. Subject: **"âœ… XÃ¡c Thá»±c Email - Máº¹ PhÆ°Æ¡ng Thá»‹ Theo"**

**KhÃ´ng tháº¥y email?**
- Check thÆ° má»¥c **Spam/Junk**
- Äá»£i 1-2 phÃºt (cÃ³ thá»ƒ delay)
- Xem pháº§n Troubleshooting

### 5.5 Verify Email

1. Má»Ÿ email
2. Click nÃºt **"âœ… XÃ¡c Thá»±c Email"** (mÃ u cam)
3. Trang má»›i má»Ÿ: `/auth/verify-email?token=...`
4. Loading... â†’ âœ… "Email Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c thÃ nh cÃ´ng!"
5. Auto redirect to `/account/login` sau 3 giÃ¢y

### 5.6 Kiá»ƒm tra Welcome Email

1. Quay láº¡i Gmail inbox
2. Email má»›i: **"ğŸ‰ ChÃ o Má»«ng Äáº¿n Vá»›i Máº¹ PhÆ°Æ¡ng Thá»‹ Theo!"**

**Tháº¥y 2 emails (Verification + Welcome)** â†’ âœ… HOÃ€N Háº¢O!

### 5.7 ÄÄƒng nháº­p

1. Truy cáº­p: **http://localhost:3000/account/login**
2. ÄÄƒng nháº­p vá»›i email vá»«a Ä‘Äƒng kÃ½
3. âœ… ThÃ nh cÃ´ng!

---

## ğŸ› TROUBLESHOOTING

### Váº¥n Äá» 1: "Error sending verification email"

#### Kiá»ƒm tra Console Logs

Trong terminal, tÃ¬m error message chi tiáº¿t:

```
âŒ Error sending verification email: Invalid login: 535-5.7.8 Username and Password not accepted
```

#### Lá»—i: "Invalid login" hoáº·c "Username and Password not accepted"

**NguyÃªn nhÃ¢n:**
- `SMTP_USER` hoáº·c `SMTP_PASS` sai

**Giáº£i phÃ¡p:**
```
1. Check SMTP_USER cÃ³ Ä‘Ãºng email khÃ´ng?
   âœ… ÄÃºng: john.doe@gmail.com
   âŒ Sai: john.doe (thiáº¿u @gmail.com)

2. Check SMTP_PASS cÃ³ pháº£i App Password khÃ´ng?
   âœ… ÄÃºng: App Password 16 kÃ½ tá»±
   âŒ Sai: Máº­t kháº©u Gmail bÃ¬nh thÆ°á»ng

3. Copy láº¡i App Password tá»« Google
   - VÃ o https://myaccount.google.com/apppasswords
   - Generate password má»›i
   - Copy chÃ­nh xÃ¡c (giá»¯ nguyÃªn khoáº£ng tráº¯ng)
   - Paste vÃ o .env

4. Restart server
   - Ctrl + C
   - npm run dev
```

#### Lá»—i: "Connection timeout" hoáº·c "ETIMEDOUT"

**NguyÃªn nhÃ¢n:**
- Firewall/network blocking
- VPN interference
- ISP blocking port 587

**Giáº£i phÃ¡p:**
```
1. Disable VPN (náº¿u cÃ³)
2. Check firewall settings
3. Try different network (mobile hotspot)
4. Check SMTP_PORT=587 (khÃ´ng pháº£i 465 hay 25)
```

#### Lá»—i: "Less secure app access"

**NguyÃªn nhÃ¢n:**
- ChÆ°a báº­t 2-Step Verification
- ChÆ°a táº¡o App Password

**Giáº£i phÃ¡p:**
```
1. Báº­t 2-Step Verification (BÆ°á»›c 1)
2. Táº¡o App Password má»›i (BÆ°á»›c 2)
3. Update .env vá»›i password má»›i
4. Restart server
```

---

### Váº¥n Äá» 2: Email vÃ o Spam

**NguyÃªn nhÃ¢n:**
- Gmail chÆ°a trust sender má»›i
- Email cÃ³ ná»™i dung spam-like

**Giáº£i phÃ¡p:**
```
1. Check spam folder
2. ÄÃ¡nh dáº¥u "Not Spam"
3. ThÃªm sender vÃ o Contacts
4. Reply email (optional)

Development: OK náº¿u vÃ o Spam
Production: Cáº§n setup SPF/DKIM records
```

---

### Váº¥n Äá» 3: File `.env` khÃ´ng hoáº¡t Ä‘á»™ng

#### Kiá»ƒm tra vá»‹ trÃ­ file

```
âœ… ÄÃºng:
C:\Users\Admin\Desktop\mephuongthitheo\.env  â† CÃ¹ng level vá»›i package.json

âŒ Sai:
C:\Users\Admin\Desktop\mephuongthitheo\app\.env  â† Sai thÆ° má»¥c
C:\Users\Admin\Desktop\.env  â† Sai vá»‹ trÃ­
```

#### Kiá»ƒm tra tÃªn file

```
âœ… ÄÃºng: .env
âŒ Sai: .env.txt
âŒ Sai: env.txt
âŒ Sai: .env.local
```

**CÃ¡ch kiá»ƒm tra trÃªn Windows:**
```
1. File Explorer
2. View â†’ Show â†’ File name extensions
3. Check tÃªn file chÃ­nh xÃ¡c lÃ  ".env"
```

#### Kiá»ƒm tra ná»™i dung

```
âœ… ÄÃºng:
SMTP_USER=john@gmail.com

âŒ Sai (cÃ³ khoáº£ng tráº¯ng thá»«a):
SMTP_USER = john@gmail.com

âŒ Sai (cÃ³ dáº¥u ngoáº·c khÃ´ng cáº§n):
SMTP_USER="john@gmail.com"
```

---

### Váº¥n Äá» 4: Server khÃ´ng load biáº¿n mÃ´i trÆ°á»ng

**Giáº£i phÃ¡p:**
```
1. Stop server: Ctrl + C
2. Start láº¡i: npm run dev
3. Check console logs

Náº¿u váº«n khÃ´ng work:
4. Delete node_modules/.cache (náº¿u cÃ³)
5. npm run dev láº¡i
```

---

## ğŸ§ª TEST SMTP CONNECTION

Script test SMTP Ä‘á»ƒ verify credentials:

### Táº¡o file `test-smtp.js`

```javascript
// test-smtp.js
const nodemailer = require('nodemailer');

const transporter = nodemailer.createTransport({
  host: 'smtp.gmail.com',
  port: 587,
  secure: false,
  auth: {
    user: 'your-email@gmail.com',      // THAY EMAIL Cá»¦A Báº N
    pass: 'abcd efgh ijkl mnop'        // THAY APP PASSWORD
  }
});

transporter.verify((error, success) => {
  if (error) {
    console.log('âŒ SMTP Error:', error.message);
  } else {
    console.log('âœ… SMTP Ready! Server is ready to send emails');
  }
});
```

### Cháº¡y test

```bash
node test-smtp.js
```

### Káº¿t quáº£

**ThÃ nh cÃ´ng:**
```
âœ… SMTP Ready! Server is ready to send emails
```

**Tháº¥t báº¡i:**
```
âŒ SMTP Error: Invalid login: 535-5.7.8 Username and Password not accepted
```
â†’ Check láº¡i email vÃ  App Password

---

## ğŸ“š FAQ

### Q1: CÃ³ thá»ƒ dÃ¹ng email khÃ¡c Gmail khÃ´ng?

**A:** CÃ³! Báº¡n cÃ³ thá»ƒ dÃ¹ng:

**Outlook/Hotmail:**
```env
SMTP_HOST=smtp-mail.outlook.com
SMTP_PORT=587
SMTP_USER=your-email@outlook.com
SMTP_PASS=your-password
```

**Yahoo:**
```env
SMTP_HOST=smtp.mail.yahoo.com
SMTP_PORT=587
SMTP_USER=your-email@yahoo.com
SMTP_PASS=your-app-password
```

### Q2: App Password cÃ³ háº¿t háº¡n khÃ´ng?

**A:** KhÃ´ng, App Password khÃ´ng háº¿t háº¡n. NhÆ°ng báº¡n cÃ³ thá»ƒ revoke báº¥t cá»© lÃºc nÃ o.

### Q3: CÃ³ thá»ƒ táº¡o nhiá»u App Password khÃ´ng?

**A:** CÃ³! Má»—i app/device nÃªn cÃ³ App Password riÃªng Ä‘á»ƒ dá»… quáº£n lÃ½.

### Q4: LÃ m sao xÃ³a App Password cÅ©?

**A:**
```
1. VÃ o https://myaccount.google.com/apppasswords
2. TÃ¬m password cáº§n xÃ³a
3. Click dáº¥u X hoáº·c "Remove"
4. Confirm
```

### Q5: Gmail cÃ³ giá»›i háº¡n gá»­i email khÃ´ng?

**A:** CÃ³:
- **Free Gmail**: 500 emails/ngÃ y
- **Google Workspace**: 2000 emails/ngÃ y

Äá»§ cho website nhá». Website lá»›n nÃªn dÃ¹ng SendGrid/AWS SES.

### Q6: Production nÃªn dÃ¹ng gÃ¬?

**A:** Khuyáº¿n nghá»‹:
- **Small/Medium**: SendGrid (100 emails/day free)
- **Large**: AWS SES ($0.10/1000 emails)
- **Gmail**: OK cho startup/testing

---

## âœ… CHECKLIST HOÃ€N THÃ€NH

- [ ] Báº­t 2-Step Verification Gmail
- [ ] Táº¡o App Password
- [ ] Copy App Password (16 kÃ½ tá»±)
- [ ] Táº¡o/Cáº­p nháº­t file `.env`
- [ ] Thay `SMTP_USER` vá»›i email tháº­t
- [ ] Thay `SMTP_PASS` vá»›i App Password
- [ ] Restart server (npm run dev)
- [ ] Test Ä‘Äƒng kÃ½ tÃ i khoáº£n
- [ ] Check console log: "âœ… Verification email sent"
- [ ] Check email inbox (hoáº·c spam)
- [ ] Click link verify trong email
- [ ] Tháº¥y "âœ… XÃ¡c Thá»±c ThÃ nh CÃ´ng"
- [ ] Nháº­n welcome email
- [ ] ÄÄƒng nháº­p thÃ nh cÃ´ng

**Táº¥t cáº£ Ä‘Ã£ check?** â†’ ğŸ‰ HOÃ€N Táº¤T!

---

## ğŸ“ Cáº§n Há»— Trá»£?

**Náº¿u váº«n gáº·p váº¥n Ä‘á»:**

1. **Check láº¡i tá»«ng bÆ°á»›c** trong hÆ°á»›ng dáº«n nÃ y
2. **Äá»c pháº§n Troubleshooting** ká»¹
3. **Run test script** `test-smtp.js`
4. **Check console logs** trong terminal
5. **Google error message** cá»¥ thá»ƒ

---

## ğŸ¯ TÃ“M Táº®T NHANH

```
1. Báº­t 2-Step Verification: 
   https://myaccount.google.com/security

2. Táº¡o App Password: 
   https://myaccount.google.com/apppasswords
   â†’ Mail â†’ Other â†’ Generate

3. Copy password (16 kÃ½ tá»±)

4. Cáº­p nháº­t .env:
   SMTP_USER=your-email@gmail.com
   SMTP_PASS=xxxx xxxx xxxx xxxx

5. Restart server:
   Ctrl + C â†’ npm run dev

6. Test:
   ÄÄƒng kÃ½ â†’ Check email â†’ Verify â†’ Done!
```

---

**Thá»i gian setup:** ~10 phÃºt

**Äá»™ khÃ³:** â­â­â˜†â˜†â˜† (Dá»…)

**Status:** âœ… Ready to use!

---

_Cáº­p nháº­t láº§n cuá»‘i: 28/10/2025_

