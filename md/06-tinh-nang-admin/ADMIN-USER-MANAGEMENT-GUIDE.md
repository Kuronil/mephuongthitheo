# HÆ°á»›ng dáº«n Quáº£n lÃ½ NgÆ°á»i dÃ¹ng cho Admin

## ğŸ“ Truy cáº­p

**URL:** `/admin/users`

Hoáº·c tá»« Admin Dashboard â†’ Click nÃºt **"NgÆ°á»i dÃ¹ng"** trong pháº§n "Thao tÃ¡c nhanh"

---

## âœ¨ CÃ¡c tÃ­nh nÄƒng

### 1. **Xem danh sÃ¡ch ngÆ°á»i dÃ¹ng**
- Hiá»ƒn thá»‹ báº£ng Ä‘áº§y Ä‘á»§ thÃ´ng tin ngÆ°á»i dÃ¹ng
- Thá»‘ng kÃª tá»•ng quan (4 cards):
  - Tá»•ng ngÆ°á»i dÃ¹ng
  - NgÆ°á»i dÃ¹ng hoáº¡t Ä‘á»™ng
  - NgÆ°á»i dÃ¹ng má»›i thÃ¡ng nÃ y
  - ThÃ nh viÃªn VIP (Gold/Platinum)

### 2. **TÃ¬m kiáº¿m vÃ  lá»c**
- TÃ¬m kiáº¿m theo: TÃªn, Email, Sá»‘ Ä‘iá»‡n thoáº¡i
- Lá»c theo cáº¥p Ä‘á»™ thÃ nh viÃªn: Bronze, Silver, Gold, Platinum

### 3. **Thao tÃ¡c vá»›i tá»«ng ngÆ°á»i dÃ¹ng**

#### ğŸ‘ï¸ **Xem chi tiáº¿t** (nÃºt Eye)
- Xem Ä‘áº§y Ä‘á»§ thÃ´ng tin ngÆ°á»i dÃ¹ng
- Hiá»ƒn thá»‹: Äiá»ƒm tÃ­ch lÅ©y, Tá»•ng Ä‘Æ¡n hÃ ng, Tá»•ng chi tiÃªu

#### âœï¸ **Chá»‰nh sá»­a** (nÃºt Edit)
- Sá»­a thÃ´ng tin ngÆ°á»i dÃ¹ng (Ä‘ang phÃ¡t triá»ƒn)

#### âš ï¸ **VÃ´ hiá»‡u hÃ³a** (nÃºt cam XCircle)
- VÃ´ hiá»‡u hÃ³a tÃ i khoáº£n
- NgÆ°á»i dÃ¹ng khÃ´ng thá»ƒ Ä‘Äƒng nháº­p
- Dá»¯ liá»‡u lá»‹ch sá»­ Ä‘Æ°á»£c giá»¯ láº¡i

#### ğŸ—‘ï¸ **XÃ³a vÄ©nh viá»…n** (nÃºt Ä‘á» Trash)
- **Cáº¢NH BÃO:** KhÃ´ng thá»ƒ hoÃ n tÃ¡c!
- XÃ³a ngÆ°á»i dÃ¹ng vÃ  Táº¤T Cáº¢ dá»¯ liá»‡u liÃªn quan:
  - âœ… ÄÆ¡n hÃ ng vÃ  lá»‹ch sá»­ Ä‘áº·t hÃ ng
  - âœ… Chi tiáº¿t Ä‘Æ¡n hÃ ng
  - âœ… Giá» hÃ ng
  - âœ… Danh sÃ¡ch yÃªu thÃ­ch
  - âœ… ÄÃ¡nh giÃ¡ sáº£n pháº©m
  - âœ… Äiá»ƒm tÃ­ch lÅ©y vÃ  giao dá»‹ch
  - âœ… ThÃ´ng bÃ¡o
  - âœ… Lá»‹ch sá»­ tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng

---

## ğŸ”¥ TÃ­nh nÄƒng má»›i: XÃ³a hÃ ng loáº¡t

### **NÃºt "XÃ³a táº¥t cáº£ ngÆ°á»i dÃ¹ng"** (mÃ u Ä‘á»)

Vá»‹ trÃ­: Header trang quáº£n lÃ½ ngÆ°á»i dÃ¹ng

**Chá»©c nÄƒng:**
- XÃ³a Táº¤T Cáº¢ ngÆ°á»i dÃ¹ng khÃ´ng pháº£i admin
- Chá»‰ giá»¯ láº¡i tÃ i khoáº£n admin

**Quy trÃ¬nh:**

1. **BÆ°á»›c 1:** Click nÃºt "XÃ³a táº¥t cáº£ ngÆ°á»i dÃ¹ng"

2. **BÆ°á»›c 2:** XÃ¡c nháº­n láº§n 1
   ```
   ğŸ—‘ï¸ XÃ“A Táº¤T Cáº¢ NGÆ¯á»œI DÃ™NG
   
   Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a Táº¤T Cáº¢ ngÆ°á»i dÃ¹ng khÃ´ng pháº£i admin?
   
   ğŸ“Š Sáº½ xÃ³a: X ngÆ°á»i dÃ¹ng
   
   âš ï¸ Cáº¢NH BÃO Cá»°C Máº NH:
   â€¢ Thao tÃ¡c nÃ y KHÃ”NG THá»‚ HOÃ€N TÃC
   â€¢ Táº¥t cáº£ X ngÆ°á»i dÃ¹ng sáº½ bá»‹ xÃ³a vÄ©nh viá»…n
   â€¢ Táº¥t cáº£ dá»¯ liá»‡u liÃªn quan sáº½ bá»‹ xÃ³a
   
   Chá»‰ tÃ i khoáº£n ADMIN sáº½ Ä‘Æ°á»£c giá»¯ láº¡i.
   ```

3. **BÆ°á»›c 3:** XÃ¡c nháº­n láº§n 2 (Double confirmation)
   ```
   Äá»ƒ xÃ¡c nháº­n xÃ³a X ngÆ°á»i dÃ¹ng, vui lÃ²ng nháº­p: DELETE ALL
   ```

4. **BÆ°á»›c 4:** Há»‡ thá»‘ng xá»­ lÃ½
   - XÃ³a tá»«ng ngÆ°á»i dÃ¹ng vÃ  dá»¯ liá»‡u liÃªn quan
   - Hiá»ƒn thá»‹ káº¿t quáº£:
     - Sá»‘ ngÆ°á»i dÃ¹ng Ä‘Ã£ xÃ³a thÃ nh cÃ´ng
     - Sá»‘ ngÆ°á»i dÃ¹ng tháº¥t báº¡i (náº¿u cÃ³)

---

## ğŸ›¡ï¸ Báº£o vá»‡ Admin

- **KhÃ´ng thá»ƒ xÃ³a tÃ i khoáº£n admin**
- API sáº½ tá»« chá»‘i náº¿u cá»‘ gáº¯ng xÃ³a admin
- ThÃ´ng bÃ¡o lá»—i: "Cannot delete admin user"

---

## ğŸ”Œ API Endpoints

### 1. **Láº¥y danh sÃ¡ch ngÆ°á»i dÃ¹ng**
```
GET /api/admin/users
```

**Query Parameters:**
- `page`: Trang (máº·c Ä‘á»‹nh: 1)
- `limit`: Sá»‘ lÆ°á»£ng/trang (máº·c Ä‘á»‹nh: 10)
- `search`: TÃ¬m kiáº¿m theo tÃªn/email/phone
- `tier`: Lá»c theo cáº¥p Ä‘á»™ (BRONZE, SILVER, GOLD, PLATINUM)

**Response:**
```json
{
  "success": true,
  "data": {
    "users": [...],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 50,
      "pages": 5
    },
    "stats": {
      "totalUsers": 50,
      "activeUsers": 48,
      "newUsersThisMonth": 5,
      "topTierUsers": 3
    }
  }
}
```

### 2. **XÃ³a ngÆ°á»i dÃ¹ng**
```
DELETE /api/admin/users/{id}
```

**Quy trÃ¬nh xÃ³a:**
1. Kiá»ƒm tra user tá»“n táº¡i
2. Kiá»ƒm tra khÃ´ng pháº£i admin
3. XÃ³a product reviews
4. XÃ³a cart items
5. XÃ³a wishlist items
6. XÃ³a loyalty transactions
7. XÃ³a notifications
8. XÃ³a order status logs
9. XÃ³a order items
10. XÃ³a orders
11. XÃ³a user

**Response thÃ nh cÃ´ng:**
```json
{
  "success": true,
  "message": "User deleted successfully with all related data"
}
```

**Response lá»—i:**
```json
{
  "success": false,
  "error": "Cannot delete admin user"
}
```

---

## ğŸ“ Script Command Line

### **XÃ³a táº¥t cáº£ ngÆ°á»i dÃ¹ng trá»« admin (tá»« terminal)**

```bash
npx ts-node scripts/delete-user.ts --delete-all-except-admin
```

**CÃ¡c lá»‡nh khÃ¡c:**

```bash
# XÃ³a theo ID
npx ts-node scripts/delete-user.ts --id=1

# XÃ³a theo Email
npx ts-node scripts/delete-user.ts --email=test@example.com

# XÃ³a táº¥t cáº£ user test
npx ts-node scripts/delete-user.ts --delete-test-users

# Liá»‡t kÃª táº¥t cáº£ users
npx ts-node scripts/list-users.ts
```

---

## âš ï¸ LÆ°u Ã½ quan trá»ng

### **Khi nÃ o nÃªn XÃ“A ngÆ°á»i dÃ¹ng:**
- âœ… TÃ i khoáº£n spam
- âœ… TÃ i khoáº£n test
- âœ… YÃªu cáº§u xÃ³a tá»« ngÆ°á»i dÃ¹ng (GDPR)
- âœ… TÃ i khoáº£n vi pháº¡m chÃ­nh sÃ¡ch

### **Khi nÃ o NÃŠN VÃ” HIá»†U HÃ“A thay vÃ¬ XÃ“A:**
- âœ… NgÆ°á»i dÃ¹ng cÃ³ Ä‘Æ¡n hÃ ng cÅ© (cáº§n giá»¯ lá»‹ch sá»­)
- âœ… Táº¡m thá»i cháº·n tÃ i khoáº£n
- âœ… ChÆ°a cháº¯c cháº¯n muá»‘n xÃ³a vÄ©nh viá»…n

### **Khuyáº¿n nghá»‹:**
> ğŸ’¡ **VÃ´ hiá»‡u hÃ³a** lÃ  lá»±a chá»n an toÃ n hÆ¡n vÃ¬ cÃ³ thá»ƒ khÃ´i phá»¥c láº¡i.
> 
> ğŸ—‘ï¸ **XÃ³a vÄ©nh viá»…n** chá»‰ nÃªn dÃ¹ng khi thá»±c sá»± cáº§n thiáº¿t.

---

## ğŸ¯ TÃ³m táº¯t

**Trang quáº£n lÃ½ ngÆ°á»i dÃ¹ng** (`/admin/users`) hiá»‡n Ä‘Ã£ cÃ³ Ä‘áº§y Ä‘á»§ chá»©c nÄƒng:

- âœ… Xem danh sÃ¡ch vÃ  thá»‘ng kÃª
- âœ… TÃ¬m kiáº¿m vÃ  lá»c
- âœ… Xem chi tiáº¿t ngÆ°á»i dÃ¹ng
- âœ… VÃ´ hiá»‡u hÃ³a tÃ i khoáº£n
- âœ… XÃ³a tá»«ng ngÆ°á»i dÃ¹ng
- âœ… **XÃ³a hÃ ng loáº¡t táº¥t cáº£ ngÆ°á»i dÃ¹ng** (NEW!)
- âœ… Báº£o vá»‡ tÃ i khoáº£n admin
- âœ… XÃ³a cascade táº¥t cáº£ dá»¯ liá»‡u liÃªn quan

---

**Cáº­p nháº­t:** 28/10/2025


